### 语法分析设计文档

------

#### 流程

###### 整体流程

->语法词法分析器初始化

->语法分析器自顶向下分析文法，每次向词法分析器发出获得一个词的请求

->词法分析器接受请求开始运行，并返回一个次的结果

->语法分析器继续运行

###### 语法分析器流程

自顶向下从程序开始分析语法

->从当前程序进入到更小的子程序之前，预读一个符号

->将符号与子程序的第一个词相匹配，决定分支（若一个词无法决定，则继续预读，直至决定分支方向）

->进入子程序，打印之前的预读符号；子程序运行到最后，打印当前子程序信息，并预读一个符号后，退出当前子程序。

#### 主要内容设计

###### 全局变量

| 变量                                          | 作用                                                         |
| --------------------------------------------- | ------------------------------------------------------------ |
| static string SYM;                            | 保存当前词法分析器返回词的词内容                             |
| static string TYPE;                           | 保存当前词法分析器返回词的词类型                             |
| static queue<pair<string,string>> BACKSTRACK; | 当预读一个词无法决定分支时，需要将预读词存入该全局队列；子程序中需从该队列中取出之前预读的词 |
| static map<string, string> FUNC_TYPE;         | 函数声明时保存函数名与函数类型的对应关系。用于语句调用时判断是有返回值函数调用还是无返回值函数调用 |

###### 宏

| 宏名                       | 作用                                                         |
| -------------------------- | ------------------------------------------------------------ |
| PRE_READ_NEW_WORD_FROM_LEX | 从语法分析器中预读一个词                                     |
| PRE_READ_NEW_WORD_FROM_ALL | 若预读队列里有词，则从队列弹出队首词；若没有，则从词法分析器中预读一个词 |
| READ_NEW_WORD              | 若队列中有词，则读取队首词并打印；若没有，则从词法分析器中读一个词并打印 |
| PRINT_PRE_WORD             | 打印所预读的词                                               |
| CALL类宏定义               | 判断是否满足进入某个子程序的条件                             |

注：预读与非预读的区别是前者不能打印当前词，后者需要打印当前词

###### 语法分析函数

| 函数名               | 作用                |
| -------------------- | ------------------- |
| Program              | ’程序‘程序          |
| Constant_description | '常量说明'子程序    |
| Variable_description | ’变量说明‘子程序    |
| Constant_define      | '常量定义'子程序... |
| ... ...              |                     |

一个语法分析函数运行的例子（以<常量说明为例>）

```c++
//<constant_description>---------------------------------------------
void constant_description() {//FIRST={CONST}
    PRINT_PRE_NEW_WORD   //打印进入该子程序前预读的词
    PRE_READ_NEW_WORD_FROM_LEX//从词法分析器预读一个词
    CALL_Constant_define //判断预读词是否满足进入常量定义子程序条件，满足则进入，不满足则报错
    if (TYPE == "SEMICN") PRINT_PRE_WORD else error();//从<常量定义>子程序退出后，判断预读的词是否满足接下来的文法，满足则打印预读词汇，不满足则报错
    PRE_READ_NEW_WORD_FROM_LEX//预读一个词汇（在不知道什么时候会退出的时候都要预读词汇）
    while (TYPE == "CONSTTK") {//判断是否继续在当前文法是则进入
        PRINT_PRE_WORD	//打印之前用于判断的预读词汇
        PRE_READ_NEW_WORD_FROM_LEX //预读
        CALL_Constant_define	//调用常量定义
        if (TYPE == "SEMICN") PRINT_PRE_WORD else error(); //判断文法
        PRE_READ_NEW_WORD_FROM_LEX //预读
    }

#ifdef TURN_ON
    file_out << "<常量说明>" << endl;  //打印
#endif
}
```

